
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flowchart Designer</title>
    <script src="https://unpkg.com/gojs/release/go.js"></script>
    <style>
        #myDiagramDiv { width: 100%; height: 500px; border: 1px solid black; }
        button, select { margin: 5px; }
    </style>
</head>
<body>

    <button onclick="addNode()">Add Node</button>
    <button onclick="saveFlowchart()">Save</button>
    <select id="flowchartList" onchange="loadFlowchart()">
        <option value="">Select a saved flowchart</option>
    </select>
    <div id="myDiagramDiv"></div>

    <script>
        const $ = go.GraphObject.make;
        const diagram = $(go.Diagram, "myDiagramDiv", {
            "undoManager.isEnabled": true
        });

        diagram.nodeTemplate =
            $(go.Node, "Auto",
                { 
                    locationSpot: go.Spot.Center,
                    movable: true, 
                    deletable: false, 
                    click: (e, node) => editNodeText(node)
                },
                $(go.Shape, "RoundedRectangle",
                    { fill: "lightblue", stroke: "black" }),
                $(go.TextBlock,
                    { margin: 8, editable: true },
                    new go.Binding("text", "key").makeTwoWay()
                )
            );

        diagram.linkTemplate =
            $(go.Link,
                { routing: go.Link.AvoidsNodes, curve: go.Link.JumpOver },
                $(go.Shape),
                $(go.Shape, { toArrow: "Standard" })
            );

        function addNode() {
            const key = "Node " + (diagram.model.nodeDataArray.length + 1);
            diagram.startTransaction("add node");
            diagram.model.addNodeData({ key });
            diagram.commitTransaction("add node");
        }

        function editNodeText(node) {
            const textBlock = node.findObject("TEXT");
            diagram.commandHandler.editTextBlock(textBlock);
        }

        function saveFlowchart() {
            const name = prompt("Enter a name for the flowchart:");
            if (!name) return;

            const json = diagram.model.toJson();
            localStorage.setItem(name, json);
            updateFlowchartList();
        }

        function loadFlowchart() {
            const name = document.getElementById("flowchartList").value;
            if (name) {
                const json = localStorage.getItem(name);
                diagram.model = go.Model.fromJson(json);
            }
        }

        function updateFlowchartList() {
            const select = document.getElementById("flowchartList");
            select.innerHTML = '<option value="">Select a saved flowchart</option>';
            Object.keys(localStorage).forEach(name => {
                const option = document.createElement("option");
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });
        }

        updateFlowchartList();
    </script>

</body>
</html>

